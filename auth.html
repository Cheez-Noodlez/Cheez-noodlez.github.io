<div id="pantry-gate">
    <h3>🔐 SMS GATEWAY</h3>
    
    <!-- Step 1: Enter Phone -->
    <div id="step-1">
        <input type="tel" id="phoneNumber" placeholder="+1 555-555-5555">
        <button class="btn" onclick="sendOTP()">SEND CODE 📲</button>
    </div>

    <!-- Step 2: Enter Code (Hidden at first) -->
    <div id="step-2" style="display:none;">
        <input type="text" id="otpCode" placeholder="Enter 6-digit code">
        <button class="btn" onclick="verifyOTP()">VERIFY & ENTER 🧀</button>
    </div>

    <!-- Required for Firebase Bot Protection -->
    <div id="recaptcha-container"></div>
</div>
<script type="module">
  import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com";

const auth = getAuth();

// 1. Setup the Anti-Bot check
window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
  'size': 'invisible'
});

// 2. Attach to window so HTML can see it
window.sendOTP = function() {
    const number = document.getElementById('phoneNumber').value;
    const appVerifier = window.recaptchaVerifier;

    signInWithPhoneNumber(auth, number, appVerifier)
        .then((confirmationResult) => {
            window.confirmationResult = confirmationResult;
            document.getElementById('step-1').style.display = 'none';
            document.getElementById('step-2').style.display = 'block';
            console.log("SMS Sent!");
        }).catch((error) => {
            console.error("SMS Error:", error);
            alert("Check Console for Error!");
        });
};

window.verifyOTP = function() {
    const code = document.getElementById('otpCode').value;
    window.confirmationResult.confirm(code).then((result) => {
        window.location.href = "hub.html"; 
    }).catch((error) => {
        alert("Invalid Code!");
    });
};

</script>
